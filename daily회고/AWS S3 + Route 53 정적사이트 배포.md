## Task 목표
최근 아버지 회사 홈페이지 코드를 조금 수정할일이 있어서 S3에 있던 버킷을 내리고 다시 올리려고 했는데 도무지 어떻게 했는지 기억이 안났다... 그래서 다시 처음부터 알아보고 중간에 약간 문제가 있었지만 해결했다.

### S3로 정적 배포하기
흔히들 S3는 저장소로만 생각하겠지만, s3에 저장되어있는 데이터들은 외부로 노출될수있고 그렇게 되면 저장되어 있는 데이터들을 외부 유저들도 볼수있다. 당연 민감한 데이터가 올라가 있다면 노출시켜서는 안돼지만 나는 아부지 홈페이지를 간단한 html + css + js로 만들어 노출시켜야 사람들이 볼수있으므로 정적사이트를 배포하였다.

우선 첫번째로 할일은 버킷을 만드는 작업을 해야한다.


버킷 이름은 왜 그래야 하는지 모르겠지만 route 53에서 배포하고자 하는 url과 이름이 같아야 해서 이번같은 경우는 버킷이름을 www.joysystem.co.kr 로 맞췄다. 리전은 내가 한국에 있고 아부지 회사를 방문하는 사람들은 보통은 한국에 있을것이기 때문에 한국으로 하였다.


모든 퍼블릭 엑세스 차단에 체크 되어있는걸 해제해 줘야한다. 그래야만 외부에서 접근이 가능해진다. 그리고 이미지에서 처럼 체크 되어있는 부분에 내용은 위에서 언급한것과 같다. 퍼블릭 엑세스 차단을 해제하면 당연히 안에있는 객체를 볼수있을것이고 그러면 민감한 데이터가 노출될수있다. 라는 내용과 비슷하다. 아무튼 우리는 페이지가 노출되어야 하기때문에 체크해주었다.

일단은 여기까지가 세팅하면 되는 부분이고 이제 버킷 만들기를 하고 세부 설정을 해야한다.

만들어진 버킷에 들어가 '속성'탭으로 가면 정적 웹 사이트 호스팅이라고 있는데 여기서 편집을 누르고

![[Pasted image 20220813230621.png]]

정적 웹사이트를 활성화 해줘야한다. 

그리고 버킷을 만들면서 퍼블릭으로 전환했지만 버킷에 대한 정책도 만들어 줘야만 비로서 외부에서 접근이 가능해진다.


버킷 정책은 '권한'탭에서 할수있다. 버킷 정책으로 가서 편집을 누르고 정책 생성기로 들어가서 정책을 만들어 보자.

![[Pasted image 20220813231130.png]]

select type of policy: 어떤 기능에 대한것이냐 
effect: 허용정책이냐 거부정책이냐를 정함 (whitelist or blacklist)
principal:대상은 누구냐
acations: 어떤 작업을 할거냐 (여기서는 객체 접근만 가능하게 하는거라 getObject하나면 충분)
Amazon Resource Name: 어떤 버킷을 대상으로 할거냐

![[Pasted image 20220813231322.png]]


이후 Add statement를 누르면 generate policy가 나온다 그걸 누르면 우리가 원하는 정책을 생성시켜준다.

![[스크린샷 2022-08-13 오후 11.15.03.png]]

이제 저 정책을 복사해서 버킷 정책에 붙여넣기 해주면 되는데 주의해야할게 이넘이 이상하게 클릭하면 디폴트로 스페이스바 하나만큼 띄어서 시작한다. 그렇게 되면 error뜨니까 확실히 왼쪽에 다붙어서 시작하는지 잘 확인하고 붙여넣자.

이러면 이제 잘된거고 마지막 route53만 조정해주면 된다. 만들때 레코드 추가하기에서 A레코드로 만들고 도메인은 만들어둔 버킷이름과 동일하게 하여 www.joysystem.co.kr 로 한후 별칭에서 s3 뭐시기 있는데 그거 클릭하고 엔드포인트 맞춰주면 된다.

